@if (popoverData()) {
  <div class="w-full">
    <!-- Title: tuned font-size/weight/color to match design -->
    <h2 class="text-lg md:text-xl leading-tight font-semibold tracking-tight text-gray-600 my-5">Lorem Ipsum Dolor Sit</h2>

    <div class="flex flex-col lg:flex-row gap-4 md:gap-5 w-full">
      <!-- Asset Risk Table -->
      <div class="overflow-hidden basis-1/2 rounded-md border border-gray-50 bg-white shadow-card-sm flex flex-col">
        <div class="px-6 md:px-8 pt-3 pb-2 border-b border-gray-50 flex-shrink-0">
          <div class="flex items-center justify-between gap-8">
            <h3 class="text-xs leading-tight font-medium tracking-tight text-gray-400">Asset</h3>
            <h3 class="text-xs leading-tight font-medium tracking-tight text-gray-400">Contextual Risk</h3>
          </div>
        </div>
          
        <div class="divide-y flex-shrink-0 lg:flex-1 lg:overflow-y-auto divide-gray-50">
          @for (asset of paginatedAssets(); track asset.id) {
            <div class="flex items-center justify-between px-6 md:px-8 py-3 hover:bg-gray-50 transition-colors gap-8">
              <div class="flex items-center gap-3 flex-1 min-w-0">
                <img 
                  src="assets/icons/server.svg" 
                  alt="server" 
                  class="flex-shrink-0 w-[45px] h-[45px] min-w-[45px] min-h-[45px]">
                <div class="min-w-0 flex-1 overflow-hidden">
                  <div class="truncate text-sm leading-[18px] font-semibold tracking-normal capitalize text-gray-700">
                    {{ asset.name }}
                  </div>
                  <div class="truncate text-xs leading-[13px] font-medium tracking-normal text-gray-500 mt-1">
                    {{ asset.ipAddress }}
                  </div>
                </div>
              </div>
              <span [ngClass]="{
                'bg-red-100 text-red-600': asset.riskLevel === 'Critical',
                'bg-orange-100 text-orange-600': asset.riskLevel === 'High',
                'bg-yellow-100 text-yellow-600': asset.riskLevel === 'Medium',
                'bg-emerald-100 text-emerald-600': asset.riskLevel === 'Low'
              }" class="risk-badge whitespace-nowrap flex-shrink-0">
                {{ asset.riskLevel }}
              </span>
            </div>
          }
        </div>

        <div class="flex items-center justify-center gap-4 px-6 md:px-8 border-t border-gray-50 text-gray-500 h-11 py-3 flex-shrink-0">
          <button 
            type="button"
            (click)="prevPage()"
            [disabled]="currentPage() === 1"
            class="pagination-btn"
            [class.disabled]="currentPage() === 1">
            ‹
          </button>
          <span class=" text-xs">
            Showing {{ (currentPage() - 1) * pageSize + 1 }}-{{ min(currentPage() * pageSize, popoverData()!.details.assets.length) }} of {{ popoverData()!.details.assets.length }}
          </span>
          <button 
            type="button"
            (click)="nextPage()"
            [disabled]="currentPage() === totalPages()"
            class="pagination-btn"
            [class.disabled]="currentPage() === totalPages()">
            ›
          </button>
        </div>
      </div>

     <!-- Contextual Risk Donut - Single component for all screens -->
<div class="basis-1/2 rounded-[20px] border-[1.1px] border-gray-50 bg-white shadow-card-md p-3 lg:px-[30px] lg:py-2.5 flex flex-col">
  <h3 class="text-sm leading-6 font-medium tracking-normal text-gray-500 mb-3">Contextual Risk</h3>
  
  <div class="flex flex-col lg:flex-row items-center lg:items-start lg:justify-between gap-3 lg:gap-4 w-full lg:flex-1">
    <!-- Legend - Uses justify-between on desktop to fill height -->
    <div class="flex flex-col items-start w-full lg:w-auto gap-1.5">
      <div class="flex items-center gap-3 lg:pt-0.5">
        <div class="w-3 h-3 rounded-full flex-shrink-0 bg-critical-dark"></div>
        <span class="text-sm leading-[100%] tracking-normal capitalize text-[#383874]">
          <span class="font-semibold">{{ currentPageRiskSummary().critical }}</span><span class="font-normal"> Critical</span>
        </span>
      </div>
      <div class="flex items-center gap-3 lg:pt-3.5">
        <div class="w-3 h-3 rounded-full flex-shrink-0 bg-warning"></div>
        <span class="text-sm leading-[100%] tracking-normal capitalize text-[#383874]">
          <span class="font-semibold">{{ currentPageRiskSummary().high }}</span><span class="font-normal"> High</span>
        </span>
      </div>
      <div class="flex items-center gap-3 lg:pt-3.5">
        <div class="w-3 h-3 rounded-full bg-yellow-500 flex-shrink-0"></div>
        <span class="text-sm leading-[100%] tracking-normal capitalize text-[#383874]">
          <span class="font-semibold">{{ currentPageRiskSummary().medium }}</span><span class="font-normal"> Medium</span>
        </span>
      </div>
      <div class="flex items-center gap-3 lg:pt-3.5">
        <div class="w-3 h-3 rounded-full flex-shrink-0 bg-success"></div>
        <span class="text-sm leading-[100%] tracking-normal capitalize text-[#383874]">
          <span class="font-semibold">{{ currentPageRiskSummary().low }}</span><span class="font-normal"> Low</span>
        </span>
      </div>
    </div>

    <!-- Donut - Centered on mobile, right-aligned on desktop -->
    <div class="flex-shrink-0 mt-4 lg:mt-0 w-full lg:w-auto flex justify-start lg:block">
      <div class="relative w-32 h-32 lg:w-28 lg:h-28 xl:w-40 xl:h-40">
        <svg viewBox="0 0 120 120" class="transform -translate-y-2 -rotate-90 w-full h-full">
          <circle cx="60" cy="60" r="50" fill="none" stroke="#F3F4F6" stroke-width="6" />
          
          @if (currentPageRiskSummary().critical > 0) {
            <circle cx="60" cy="60" r="50" fill="none" stroke="#C6190D" stroke-width="6" [attr.stroke-dasharray]="getCriticalDashArray()" [attr.stroke-dashoffset]="getCriticalDashOffset()" stroke-linecap="butt" class="donut-segment" />
          }
          @if (currentPageRiskSummary().high > 0) {
            <circle cx="60" cy="60" r="50" fill="none" stroke="#FF9500" stroke-width="6" [attr.stroke-dasharray]="getHighDashArray()" [attr.stroke-dashoffset]="getHighDashOffset()" stroke-linecap="butt" class="donut-segment" />
          }
          @if (currentPageRiskSummary().medium > 0) {
            <circle cx="60" cy="60" r="50" fill="none" stroke="#EAB308" stroke-width="6" [attr.stroke-dasharray]="getMediumDashArray()" [attr.stroke-dashoffset]="getMediumDashOffset()" stroke-linecap="butt" class="donut-segment" />
          }
          @if (currentPageRiskSummary().low > 0) {
            <circle cx="60" cy="60" r="50" fill="none" stroke="#02983E" stroke-width="6" [attr.stroke-dasharray]="getLowDashArray()" [attr.stroke-dashoffset]="getLowDashOffset()" stroke-linecap="butt" class="donut-segment" />
          }
        </svg>
        
        <div class="absolute -translate-y-2 inset-0 flex flex-col items-center justify-center">
          <span class="text-2xl lg:text-2xl xl:text-3xl leading-7 font-semibold text-[#656575]">{{ currentPageRiskSummary().critical }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
    </div>
  </div>
}